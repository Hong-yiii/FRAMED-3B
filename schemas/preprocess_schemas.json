{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Preprocess Service Schemas",
  "description": "Input and output schemas for the preprocess service",
  "definitions": {
    "processing_metadata": {
      "type": "object",
      "description": "Processing metadata generated by preprocess service",
      "properties": {
        "original_size": {
          "type": "array",
          "items": {"type": "integer"},
          "minItems": 2,
          "maxItems": 2,
          "description": "Original image dimensions [width, height]"
        },
        "standardized_size": {
          "type": "array",
          "items": {"type": "integer"},
          "minItems": 2,
          "maxItems": 2,
          "description": "Standardized image dimensions [width, height]"
        },
        "processing_method": {
          "type": "string",
          "description": "Method used for processing (e.g., 'quality_preserved')"
        }
      },
      "required": ["original_size", "standardized_size", "processing_method"],
      "additionalProperties": false
    },
    "exif_data": {
      "type": "object",
      "description": "EXIF metadata from ingest service",
      "properties": {
        "camera": {
          "type": "string",
          "description": "Camera make and model"
        },
        "lens": {
          "type": "string",
          "description": "Lens information"
        },
        "iso": {
          "type": ["number", "null"],
          "description": "ISO sensitivity"
        },
        "aperture": {
          "type": "string",
          "description": "Aperture value (e.g., 'f/2.4')"
        },
        "shutter_speed": {
          "type": "string",
          "description": "Shutter speed (e.g., '1/100')"
        },
        "focal_length": {
          "type": "string",
          "description": "Focal length (e.g., '5mm')"
        },
        "datetime": {
          "type": ["string", "null"],
          "description": "Date and time photo was taken"
        },
        "gps": {
          "type": ["object", "null"],
          "description": "GPS coordinates",
          "properties": {
            "lat": {"type": "number", "description": "Latitude"},
            "lon": {"type": "number", "description": "Longitude"},
            "alt": {"type": "number", "description": "Altitude (optional)"}
          }
        }
      },
      "additionalProperties": true
    },
    "preprocess_input": {
      "type": "object",
      "description": "Input from ingest service",
      "properties": {
        "batch_id": {
          "type": "string",
          "description": "Batch identifier"
        },
        "photo_index": {
          "type": "array",
          "description": "Photo index from ingest service",
          "items": {
            "type": "object",
            "properties": {
              "photo_id": {
                "type": "string",
                "description": "Unique photo identifier (SHA256 hash)"
              },
              "original_uri": {
                "type": "string",
                "description": "Path to original photo file"
              },
              "ranking_uri": {
                "type": "string",
                "description": "Path to JPEG version for ranking"
              },
              "exif": {
                "$ref": "#/definitions/exif_data"
              },
              "format": {
                "type": "string",
                "description": "Original file format (e.g., '.jpg', '.heic')"
              }
            },
            "required": ["photo_id", "original_uri", "ranking_uri", "format"],
            "additionalProperties": true
          }
        }
      },
      "required": ["batch_id", "photo_index"]
    },
    "preprocess_output": {
      "type": "object",
      "description": "Preprocess service output with standardized images and preserved metadata",
      "properties": {
        "batch_id": {
          "type": "string",
          "description": "Batch identifier"
        },
        "artifacts": {
          "type": "array",
          "description": "Photo artifacts with standardized versions and preserved ingest metadata",
          "items": {
            "type": "object",
            "description": "Photo artifact with all ingest metadata plus preprocessing data",
            "properties": {
              "photo_id": {
                "type": "string",
                "description": "Unique photo identifier (SHA256 hash)"
              },
              "original_uri": {
                "type": "string",
                "description": "Path to original photo file (from ingest)"
              },
              "ranking_uri": {
                "type": "string",
                "description": "Path to JPEG version for ranking (from ingest)"
              },
              "std_uri": {
                "type": "string",
                "description": "Path to standardized processed image (added by preprocess)"
              },
              "exif": {
                "$ref": "#/definitions/exif_data"
              },
              "format": {
                "type": "string",
                "description": "Original file format (from ingest)"
              },
              "processing_metadata": {
                "$ref": "#/definitions/processing_metadata"
              }
            },
            "required": ["photo_id", "original_uri", "ranking_uri", "std_uri", "processing_metadata"],
            "additionalProperties": true
          }
        }
      },
      "required": ["batch_id", "artifacts"]
    }
  }
}
